<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>코딩 캔버스 (Simple Icons v7)</title>
<style>
  :root{
    --bg:#ffffff; --panel:#f6f7f9; --text:#1f2937; --muted:#6b7280; --border:#e5e7eb; --accent:#2563eb;
    --shadow:0 10px 20px rgba(0,0,0,.06);
    /* 푸터 높이 변수 */
    --footer-h: 56px;
  }
  html.dark{ --bg:#0b1020; --panel:#141a2f; --text:#e5e7eb; --muted:#a3acc2; --border:#2a3350; --accent:#60a5fa; --shadow:0 10px 20px rgba(0,0,0,.25); }
  *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  /* 화면을 좌/우 두 칼럼으로, 푸터는 별도 행 */
  body{
    margin:0; background:var(--bg); color:var(--text);
    font:14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', Arial, sans-serif;
    min-height:100vh;
    display:grid;
    grid-template-columns:1fr 1fr;
    grid-auto-rows:auto;
  }
  /* 좌/우 영역을 푸터 높이를 제외한 뷰포트 높이만큼 채움 */
  .left, .right{
    min-height:calc(100vh - var(--footer-h));
    display:flex; flex-direction:column; min-width:0;
  }
  .left{ border-right:1px solid var(--border); }

  .topbar{ display:flex; align-items:center; justify-content:space-between; gap:8px; padding:10px 12px; border-bottom:1px solid var(--border); background:var(--panel); }
  /* 로고 2배 확대 (48 → 96) */
  .logo img{ height:96px; display:block; cursor:pointer; }
  .iconbar{ display:flex; align-items:center; gap:8px; }
  .iconbtn{ border:1px solid var(--border); background:#fff0; color:var(--text); padding:10px; border-radius:12px; cursor:pointer; display:inline-flex; align-items:center; justify-content:center; min-width:42px; min-height:42px; box-shadow:var(--shadow); }
  .iconbtn:hover{ background:rgba(0,0,0,0.04) }
  .iconbtn.active{ border-color:var(--accent); background:color-mix(in srgb, var(--accent) 12%, transparent); }
  .iconbtn svg{ width:20px; height:20px; display:block; }
  .tabs{ display:flex; gap:6px; padding:8px 10px; border-bottom:1px solid var(--border); background:var(--panel); overflow-x:auto; scrollbar-width:thin; -webkit-overflow-scrolling:touch; }
  .tab{ border:1px solid var(--border); background:#fff0; color:var(--muted); padding:8px 12px; border-radius:10px; cursor:pointer; flex:0 0 auto; }
  .tab.active{ color:var(--accent); border-color:var(--accent); background:color-mix(in srgb, var(--accent) 8%, transparent); }
  .editor{ width:100%; height:100%; border:0; outline:none; padding:14px; resize:none; font:13px/1.6 ui-monospace, SFMono-Regular, Menlo, Consolas, 'Fira Code', monospace; background:var(--bg); color:var(--text); }
  .hidden{ display:none }

  .previewbar{ display:flex; align-items:center; justify-content:flex-end; gap:8px; padding:10px 12px; border-bottom:1px solid var(--border); background:var(--panel); }
  .preview{ flex:1; display:flex; align-items:center; justify-content:center; padding:10px; overflow:auto; }
  iframe{ width:100%; height:100%; border:1px solid var(--border); border-radius:12px; background:#fff; box-shadow:var(--shadow); }
  .w375{ width:375px !important; }

  /* 푸터를 항상 하단에 고정(그리드의 마지막 행), 높이 고정 */
  footer{
    grid-column:1 / -1;
    border-top:1px solid var(--border); background:var(--panel);
    height:var(--footer-h);
  }
  footer .wrap{ height:100%; display:flex; align-items:center; justify-content:center; gap:8px; padding:0 12px; text-align:center; }
  footer a{ color:inherit; text-decoration:none; }
  footer a:hover{ text-decoration:underline; }

  /* Dialog */
  dialog{ border:1px solid var(--border); border-radius:12px; background:var(--bg); color:var(--text); padding:0; width:min(92vw,420px); }
  dialog::backdrop{ background:rgba(0,0,0,.35); }
  dialog header{ padding:12px 14px; border-bottom:1px solid var(--border); font-weight:700; }
  dialog .body{ padding:14px; }
  dialog .actions{ display:flex; gap:8px; justify-content:flex-end; padding:12px 14px; border-top:1px solid var(--border); }
  .radio-row{ display:flex; align-items:center; gap:10px; padding:8px 0; }
  .help{ color:var(--muted); font-size:12px; margin-top:6px; }

  /* Mobile */
  @media (max-width: 900px){
    body{ grid-template-columns:1fr; }
    .logo img{ height:84px; } /* 모바일에서도 2배에 맞게 */
    .iconbtn{ min-width:44px; min-height:44px; }
    .editor{ font-size:14px; }
  }
</style>
</head>
<body>
  <!-- LEFT: INPUT -->
  <section class="left">
    <div class="topbar">
      <!-- 로고 클릭 시 완전 초기화 -->
      <a class="logo" href="#" onclick="CC.hardReset(); return false;" title="처음 화면으로">
        <img src="https://i.ibb.co/Jw8sLtRy/002-2.png" alt="Coding Canvas Logo">
      </a>
      <div class="iconbar">
        <button id="run" class="iconbtn" title="실행" aria-label="실행" onclick="CC.render()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5,3 19,12 5,21 5,3" fill="currentColor"></polygon></svg>
        </button>
        <button id="autorunBtn" class="iconbtn" title="자동실행" aria-label="자동실행(토글)" onclick="CC.toggleAuto()">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M13 2L3 14h7l-1 8 10-12h-7l1-8z"></path></svg>
        </button>
        <button id="theme" class="iconbtn" title="라이트/다크 전환" aria-label="테마 전환" onclick="CC.toggleTheme()">
          <svg id="themeIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="4"></circle>
            <path d="M12 2v2M12 20v2M2 12h2M20 12h2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"></path>
          </svg>
        </button>
        <button id="save" class="iconbtn" title="다운로드" aria-label="다운로드" onclick="CC.openDownload()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3v10"></path><path d="M7 12l5 5 5-5"></path><rect x="3" y="17" width="18" height="4" rx="1"></rect></svg>
        </button>
        <input id="loadInput" type="file" accept=".json,.txt,.html,.htm,.css,.js" class="hidden" />
        <button id="load" class="iconbtn" title="불러오기 / 파일 열기" aria-label="불러오기" onclick="document.getElementById('loadInput').click()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7h6l2 2h10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7z"></path><path d="M3 12h18"></path></svg>
        </button>
        <button id="reset" class="iconbtn" title="초기화" aria-label="초기화" onclick="CC.reset()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-3-6.7"></path><path d="M21 3v6h-6"></path></svg>
        </button>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" type="button" data-for="html" onclick="CC.switchTab('html')">HTML</button>
      <button class="tab" type="button" data-for="css" onclick="CC.switchTab('css')">CSS</button>
      <button class="tab" type="button" data-for="js" onclick="CC.switchTab('js')">JS</button>
    </div>

    <div style="flex:1; min-height:0; position:relative;">
      <textarea id="html" class="editor" spellcheck="false"><h1>안녕하세요!</h1>
<p>왼쪽에서 코드를 입력하고, <strong>실행</strong> 버튼을 눌러보세요.</p>
<button onclick="showAlert()">클릭해보세요</button></textarea>

      <textarea id="css" class="editor hidden" spellcheck="false">body{
  font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', Arial, sans-serif;
  padding: 20px;
  background: #eaf3ff;
  text-align: center;
}
h1{ color:#1e40af }
button{
  background:#2563eb; color:white; border:0; padding:10px 18px; border-radius:10px;
}
button:hover{ filter:brightness(.95) }</textarea>

      <textarea id="js" class="editor hidden" spellcheck="false">function showAlert(){
  const box = document.createElement('div');
  box.textContent = '버튼이 클릭되었습니다! ' + new Date().toLocaleTimeString();
  box.style.cssText = 'margin-top:20px;padding:12px;border:1px solid #93c5fd;background:#dbeafe;border-radius:10px;color:#1e40af';
  document.body.appendChild(box);
}
console.log('콘솔 테스트: 정상 동작');</textarea>
    </div>
  </section>

  <!-- RIGHT: PREVIEW -->
  <section class="right">
    <div class="previewbar">
      <button id="desktop" class="iconbtn active" title="데스크톱" aria-label="데스크톱" onclick="CC.setDesktop()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="12" rx="2"></rect><path d="M8 20h8"></path></svg>
      </button>
      <button id="mobile" class="iconbtn" title="모바일(375px)" aria-label="모바일" onclick="CC.setMobile()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="7" y="2" width="10" height="20" rx="2"></rect><circle cx="12" cy="18" r="1"></circle></svg>
      </button>
    </div>
    <div class="preview">
      <iframe id="view" title="미리보기"></iframe>
    </div>
  </section>

  <footer>
    <div class="wrap">
      <a href="https://litt.ly/chichiboo" target="_blank" rel="noopener noreferrer">created by. 교육뮤지컬 꿈꾸는 치수쌤</a>
    </div>
  </footer>

  <!-- Download dialog -->
  <dialog id="dlDialog">
    <header>다운로드</header>
    <div class="body">
      <div class="radio-row"><input type="radio" name="fmt" id="fmt_json" value="json" checked><label for="fmt_json">JSON (프로젝트 전체 저장)</label></div>
      <div class="radio-row"><input type="radio" name="fmt" id="fmt_txt" value="txt"><label for="fmt_txt">TXT (구분자 포함한 텍스트)</label></div>
      <div class="radio-row"><input type="radio" name="fmt" id="fmt_html" value="html"><label for="fmt_html">HTML (실행 가능한 단일 파일)</label></div>
      <div class="help">확인을 누르면 선택한 형식으로 파일을 저장합니다.</div>
    </div>
    <div class="actions">
      <button class="iconbtn" onclick="CC.closeDownload()">취소</button>
      <button class="iconbtn active" onclick="CC.confirmDownload()">확인</button>
    </div>
  </dialog>

<script>
  const CC = (function(){
    const el = {
      html: document.getElementById('html'),
      css: document.getElementById('css'),
      js: document.getElementById('js'),
      view: document.getElementById('view'),
      autorunBtn: document.getElementById('autorunBtn'),
      themeIcon: document.getElementById('themeIcon'),
      desktop: document.getElementById('desktop'),
      mobile: document.getElementById('mobile'),
      dlDialog: document.getElementById('dlDialog'),
      loadInput: document.getElementById('loadInput'),
    };

    let autoOn = true;
    function setAuto(on){
      autoOn = !!on;
      el.autorunBtn.classList.toggle('active', autoOn);
    }

    function switchTab(which){
      document.querySelectorAll('.tab').forEach(b=>b.classList.toggle('active', b.dataset.for===which));
      [el.html, el.css, el.js].forEach(t => t.classList.toggle('hidden', t.id!==which));
    }

    function buildDoc(){
      return `<!doctype html>
<html><head><meta charset="utf-8"><style>${el.css.value}</style></head>
<body>${el.html.value}<script>${el.js.value}<\/script></body></html>`;
    }

    function setPreviewContent(docStr){
      try{
        el.view.removeAttribute('sandbox');
        el.view.srcdoc = docStr;
        setTimeout(()=>{
          let ok=false;
          try{ ok = !!(el.view.contentDocument && el.view.contentDocument.body && el.view.contentDocument.body.childNodes.length); }catch(e){}
          if(!ok){
            const d = el.view.contentWindow.document;
            d.open(); d.write(docStr); d.close();
          }
        }, 40);
      }catch(e){
        try{
          const d = el.view.contentWindow.document;
          d.open(); d.write(docStr); d.close();
        }catch(e2){
          const blob = new Blob([docStr], {type:'text/html'});
          const url = URL.createObjectURL(blob);
          el.view.src = url;
          setTimeout(()=>URL.revokeObjectURL(url), 2000);
        }
      }
    }

    function render(){ setPreviewContent(buildDoc()); }

    function toggleAuto(){ setAuto(!autoOn); }

    function setThemeIcon(dark){
      el.themeIcon.innerHTML = dark
        ? '<path d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z"></path>'
        : '<circle cx="12" cy="12" r="4"></circle><path d="M12 2v2M12 20v2M2 12h2M20 12h2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"></path>';
    }
    function toggleTheme(){
      const dark = !document.documentElement.classList.contains('dark');
      document.documentElement.classList.toggle('dark', dark);
      localStorage.setItem('cc_v7_theme', dark ? 'dark':'light');
      setThemeIcon(dark);
    }

    function setDesktop(){ el.desktop.classList.add('active'); el.mobile.classList.remove('active'); el.view.classList.remove('w375'); }
    function setMobile(){ el.mobile.classList.add('active'); el.desktop.classList.remove('active'); el.view.classList.add('w375'); }

    function openDownload(){
      if (typeof el.dlDialog.showModal === 'function') el.dlDialog.showModal();
      else el.dlDialog.setAttribute('open', 'open'); // fallback
    }
    function closeDownload(){
      if (typeof el.dlDialog.close === 'function') el.dlDialog.close();
      else el.dlDialog.removeAttribute('open');
    }
    function confirmDownload(){
      const fmt = (document.querySelector('input[name="fmt"]:checked')||{}).value || 'json';
      const download = (filename, text, type)=>{
        const blob = new Blob([text], {type});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
        setTimeout(()=>URL.revokeObjectURL(url), 1000);
      };
      if(fmt==='json'){
        const payload = { html: el.html.value, css: el.css.value, js: el.js.value };
        download('coding-canvas.json', JSON.stringify(payload, null, 2), 'application/json');
      }else if(fmt==='txt'){
        const txt = ['===HTML===', el.html.value.trim(), '===CSS===', el.css.value.trim(), '===JS===', el.js.value.trim()].join('\n');
        download('coding-canvas.txt', txt, 'text/plain');
      }else{
        download('coding-canvas.html', buildDoc(), 'text/html');
      }
      closeDownload();
    }

    function reset(){
      if(!confirm('초기 상태로 되돌릴까요?')) return;
      el.html.value = DEFAULTS.html; el.css.value = DEFAULTS.css; el.js.value = DEFAULTS.js;
      render();
    }

    /* 로고 클릭 시: 완전 초기화(로컬 저장값/테마 포함) */
    function hardReset(){
      // 저장값/테마 제거
      localStorage.removeItem('cc_v7_html');
      localStorage.removeItem('cc_v7_css');
      localStorage.removeItem('cc_v7_js');
      localStorage.removeItem('cc_v7_theme');
      // 기본 코드로 복원
      el.html.value = DEFAULTS.html; el.css.value = DEFAULTS.css; el.js.value = DEFAULTS.js;
      // 테마: 라이트로 초기화
      document.documentElement.classList.remove('dark');
      setThemeIcon(false);
      // 보기 모드/자동실행 초기화
      setDesktop();
      setAuto(true);
      // 렌더
      render();
    }

    // typing debounce + tab indent
    let t;
    [el.html, el.css, el.js].forEach(ed=>{
      ed.addEventListener('input', ()=>{
        localStorage.setItem('cc_v7_html', el.html.value);
        localStorage.setItem('cc_v7_css',  el.css.value);
        localStorage.setItem('cc_v7_js',   el.js.value);
        if(!autoOn) return;
        clearTimeout(t); t = setTimeout(render, 240);
      });
      ed.addEventListener('keydown', (e)=>{
        if(e.key==='Tab'){
          e.preventDefault();
          const s = ed.selectionStart, epos = ed.selectionEnd;
          ed.value = ed.value.substring(0,s) + '  ' + ed.value.substring(epos);
          ed.selectionStart = ed.selectionEnd = s+2;
          if(autoOn){ clearTimeout(t); t = setTimeout(render, 240); }
        }
      });
    });

    // Public API
    const DEFAULTS = { html: el.html.value, css: el.css.value, js: el.js.value };
    function init(){
      const theme = localStorage.getItem('cc_v7_theme');
      const dark = theme==='dark' || (theme!=='light' && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
      document.documentElement.classList.toggle('dark', dark);
      setThemeIcon(dark);
      const hs = localStorage.getItem('cc_v7_html'); if(hs!==null) el.html.value = hs;
      const cs = localStorage.getItem('cc_v7_css');  if(cs!==null) el.css.value  = cs;
      const jsS= localStorage.getItem('cc_v7_js');   if(jsS!==null) el.js.value   = jsS;
      setAuto(true);
      render();
      el.loadInput.addEventListener('change', (e)=>{
        const file = e.target.files && e.target.files[0]; if(!file) return;
        const ext = (file.name.split('.').pop()||'').toLowerCase();
        const reader = new FileReader();
        reader.onload = ()=>{
          const text = String(reader.result||'');
          try{
            if(ext==='json'){
              const data = JSON.parse(text);
              if(typeof data.html==='string') el.html.value = data.html;
              if(typeof data.css==='string')  el.css.value  = data.css;
              if(typeof data.js==='string')   el.js.value   = data.js;
            }else if(ext==='html' || ext==='htm'){
              el.html.value = text;
            }else if(ext==='css'){
              el.css.value = text;
            }else if(ext==='js'){
              el.js.value = text;
            }else{
              const H = text.split(/===HTML===/i)[1];
              const C = text.split(/===CSS===/i)[1];
              const J = text.split(/===JS===/i)[1];
              if(H && C && J){
                const afterH = H.split(/===CSS===/i)[0];
                const afterC = C.split(/===JS===/i)[0];
                const afterJ = J;
                el.html.value = afterH.trim();
                el.css.value  = afterC.trim();
                el.js.value   = afterJ.trim();
              }else{
                el.html.value = text;
              }
            }
            render();
          }catch(err){ alert('파일을 읽는 중 오류: JSON/TXT/HTML/CSS/JS를 지원합니다.'); }
        };
        reader.readAsText(file); e.target.value='';
      });
      document.addEventListener('keydown', (e)=>{
        if((e.ctrlKey||e.metaKey) && e.key==='Enter'){ e.preventDefault(); render(); }
      });
    }

    return { init, render, toggleAuto, toggleTheme, setDesktop, setMobile, switchTab, openDownload, closeDownload, confirmDownload, reset, hardReset };
  })();

  CC.init();
</script>
</body>
</html>